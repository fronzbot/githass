thermostat_operation:
  sequence:
    - condition: state
      entity_id: input_boolean.thermostat_enable
      state: 'on'

    - service: climate.set_operation_mode
      data_template:
        entity_id: climate.living_room
        operation_mode: >
          {% if (states.sensor.pws_feelslike_f.state | int) > 77 %}
            auto
          {% elif (states.sensor.pws_feelslike_f.state | int) < 55 %}
            auto
          {% elif (states.sensor.occupancy.state == 'home') or (states.input_boolean.guest_mode.state == 'on') %}
            {% if (states.sensor.bedroom_temperature.state | int > states.sensor.pws_temp_f.state | int) and (states.sensor.pws_temp_f.state | int > 72) %}
              {% if ((states.sensor.living_room_humidity.state | int) > 58) and (now().strftime("%H") | int > 5) and (now().strftime("%H") | int < 20) %}
                auto
              {% else %}
                off
              {% endif %}
            {% else %}
              off
            {% endif %}
          {% else %}
            off
          {% endif %}