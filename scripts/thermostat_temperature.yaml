thermostat_temperature:
  sequence:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.thermostat_enable
          state: 'on'
        - condition: template
          value_template: >
            {% if states.climate.living_room.attributes.operation_mode == 'off' %}
              false
            {% else %}
              true
            {% endif %}

    - service: climate.set_temperature
      data_template:
        entity_id: climate.living_room         
        target_temp_high: >
          {% if (states.sensor.pws_feelslike_f.state | int) > 77 or (states.input_boolean.guest_mode.state == 'on')%}
            {% if (states.sensor.occupancy.state == 'home') or (states.input_boolean.guest_mode.state == 'on') or (states.input_boolean.on_the_way_home.state == 'on') %}
              {% if (now().strftime("%H") | int > 5) and (now().strftime("%H") | int < 20) %}
                {{ 75 | int }}
              {% else %}
                {{ 78 | int }}
              {% endif %}
            {% else %}
              {{ 82 | int }}
            {% endif %}
          {% else %}
            {{ 78 | int }}
          {% endif %}
        target_temp_low: >
          {% if (states.sensor.pws_feelslike_f.state | int) < 55 or (states.input_boolean.on_the_way_home.state == 'on')%}
            {% if (states.sensor.occupancy.state == 'home') or (states.input_boolean.guest_mode.state == 'on') or (states.input_boolean.on_the_way_home.state == 'on') %}
              {% if (now().strftime("%H") | int > 5) and (now().strftime("%H") | int < 20) %}
                {{ 67 | int }}
              {% else %}
                {{ 62 | int }}
              {% endif %}
            {% else %}
              {{ 57 | int }}
            {% endif %}
          {% else %}
            {{ 55 | int }}
          {% endif %}