# -------------------------------------------
# FILE GENERATED USING gen_automations SCRIPT
# GENERATED ON 2017-Jul-08 15:58:43
# -------------------------------------------

- id: thermostat_disable
  alias: Thermostat Disable
  trigger:
    - platform: state
      entity_id: input_boolean.thermostat_enable
      to: 'off'
  action:
    - service: climate.set_operation_mode
      entity_id: climate.living_room
      data:
        operation_mode: 'off'
- id: notify_on_washer_status
  alias: Notify on Washer Status
  trigger:
    - platform: state
      entity_id: sensor.washer
      from: 'Not Running'
      to: 'Running'
    - platform: state
      entity_id: sensor.washer
      from: 'Running'
      to: 'Not Running'
  action:
    - service: script.notify_all_engine
      data:
        call_washer_status: 1
- id: thermostat_change_on_weather
  alias: Thermostat Change on Weather
  trigger:
    - platform: state
      entity_id: input_boolean.thermostat_enable
      to: 'on'
    - platform: state
      entity_id: input_boolean.guest_mode
      to: 'on'
    - platform: state
      entity_id: input_boolean.guest_mode
      to: 'off'
    - platform: state
      entity_id: input_boolean.on_the_way_home
      to: 'on'
    - platform: state
      entity_id: sensor.occupancy
      to: 'home'
    - platform: state
      entity_id: sensor.occupancy
      to: 'not_home'  
    - platform: numeric_state
      entity_id: sensor.pws_feelslike_f
      above: 77
    - platform: numeric_state
      entity_id: sensor.pws_feelslike_f
      below: 55
    - platform: numeric_state
      entity_id: sensor.pws_feelslike_f
      above: 58
      below: 74
    - platform: numeric_state
      entity_id: sensor.living_room_humidity
      above: 58
    - platform: template
      value_template: '{{ (states.climate.living_room.attributes.current_temperature | float - states.sensor.pws_feelslike_f.state | float) > 2.0 }}'
    - platform: homeassistant
      event: start
  action:
    - service: script.thermostat_engine
#Turn on couch lights if it's raining, someone
# is home, and it's after 11am.
- id: lights_rainy
  alias: Lights Rainy
  trigger:
    - platform: state
      entity_id: sensor.pws_weather
      to: 'Rain'
  condition:
    condition: and
    conditions:
      - condition: time
        after: '07:00'
        before: '18:00'
      - condition: state
        entity_id: sensor.occupancy
        state: 'home'
  action:
    service: light.turn_on
    entity_id: group.couch
- id: notify_on_restart
  alias: Notify on Restart
  trigger:
    - platform: homeassistant
      event: start
  action:
    - service: script.notify_kevin_engine
      data:
        call_on_restart: 1
- id: notify_on_fire_co2
  alias: Notify on Fire/CO2
  trigger:
    - platform: state
      entity_id: sensor.smoke_alarm_kitchen
      to: "Fire"
    - platform: state
      entity_id: sensor.smoke_alarm_kitchen
      to: "CO2"
    - platform: state
      entity_id: sensor.smoke_alarm_living_room
      to: "Fire"
    - platform: state
      entity_id: sensor.smoke_alarm_living_room
      to: "CO2"
    - platform: state
      entity_id: sensor.smoke_alarm_nursery
      to: "Fire"
    - platform: state
      entity_id: sensor.smoke_alarm_nursery
      to: "CO2"
  action:
    - service: script.notify_all_engine
      data:
        call_fire_co2: 1
# Turn on outside lights 15 minutes after sunset
  
- id: lights_sunset
  alias: Lights Sunset
  trigger:
    - platform: sun
      event: sunset
      offset: '+00:15:00'
  action:
    - service: light.turn_on
      entity_id: light.porch
      data:
        brightness: 278
        color_temp: 330
    - service: switch.turn_on
      entity_id: group.driveway
- id: notify_on_way_home
  alias: Notify on Way Home
  trigger:
    - platform: state
      entity_id: input_boolean.on_the_way_home
      to: 'on'
  action:
    - service: script.notify_all_engine
      data:
        call_on_way_home: 1
# Turn on lights if we're not home and it's dark out
- id: lights_not_home
  alias: Lights Not Home
  trigger:
    - platform: sun
      event: sunset
      offset: '-00:15:00'
    - platform: state
      entity_id: sensor.occupancy
      to: 'not_home'
  condition:
    condition: and
    conditions:
      - condition: time
        after: '16:00:00'
        before: '22:00:00'
      - condition: state
        entity_id: sensor.occupancy
        state: 'not_home'
  action:
    service: light.turn_on
    entity_id: group.couch
  
- id: notify_on_system_use
  alias: Notify on System Use
  trigger:
    - platform: numeric_state
      entity_id: sensor.glances_ram_use
      above: 75.0
      below: 100.0
    - platform: numeric_state
      entity_id: sensor.glances_ram_use_2
      above: 75.0
      below: 100.0
    - platform: numeric_state
      entity_id: sensor.glances_swap_use
      above: 50.0
  action:
    - service: script.notify_kevin_engine
      data:
        call_system_use: 1
# Turn on outside lights off at 12:40 am
  
- id: lights_outdoor_off
  alias: Lights Outdoor Off
  trigger:
    - platform: time
      at: '00:40:07'
  action:
    - service: light.turn_off
      entity_id: group.exterior
    - service: switch.turn_off
      entity_id: group.outdoor_switches
    - service: switch.turn_off    
      entity_id: group.driveway
# Turn on holiday lights at sunset
- id: lights_holiday_lights
  alias: Lights Holiday Lights
  trigger:
    - platform: sun
      event: sunset
      offset: '+00:16:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: 'input_boolean.christmas_lights'
        state: 'on'
  action:
    - service: switch.turn_on
      entity_id: group.outdoor_switches
    - service: switch.turn_off
      entity_id: group.driveway
    - service: light.turn_on
      entity_id: light.porch
      data:
        brightness: 150
        xy_color: [0.1972,0.6781]
# Turn lights off when everyone leaves for work
# group.all_devices is 'not_home' if ALL devices are not home
# Only do this between 7:30am to 10:00am
  
- id: lights_away
  alias: Lights Away
  trigger:
    - platform: state
      entity_id: sensor.occupancy
      to: 'not_home'
    - platform: time
      at: '9:00:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: sensor.occupancy
        state: 'not_home'
      - condition: time
        after: '7:30:00'
        before: '10:00:00'
  action:
    service: light.turn_off
    entity_id: group.all_lights
      
# Turn lights on in the morning 
- id: lights_wakeup
  alias: Lights Wakeup
  trigger:
    - platform: time
      at: '6:30:00'
  action:
    - service: light.turn_on
      entity_id: light.couch_left
    - service: light.turn_on
      entity_id: light.kitchen_table
# Turn inside lights off around midnight (before exterior)
  
- id: lights_inside_off
  alias: Lights Inside Off
  trigger:
    - platform: time
      at: '00:12:09'
  action:
    - service: light.turn_off
      entity_id: group.interior
- id: notify_on_ssl_expiry
  alias: Notify on SSL Expiry
  trigger:
    - platform: numeric_state
      entity_id: sensor.ssl_cert_expiry
      below: 21
  action:
    - service: script.notify_kevin_engine
      data:
        call_ssl_cert_expiry: 1
# Turn lights on when someone comes home from work
# group.all_devices is 'home' if ANY device is home
# Do this between 5pm and 7pm
  
- id: lights_home
  alias: Lights Home
  trigger:
    - platform: state
      entity_id: sensor.occupancy
      to: 'home'
  condition:
    condition: and
    conditions:
      - condition: time
        after: '16:00:00'
        before: '19:00:00'
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
  action:
    - service: light.turn_on
      entity_id: group.couch
    - service: light.turn_on
      entity_id: light.kitchen_table
