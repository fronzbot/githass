#---------------- SMASH.PY ------------------
# Generated: 2020-May-24 00:41:27 
#--------------------------------------------

#--- automation/notify_on_failed_login.yaml ---
- id: notify_on_failed_login
  alias: Notify on Failed Login
  trigger:
    - platform: state
      entity_id: sensor.fail2ban_nginx_http_auth
    - platform: state
      entity_id: sensor.fail2ban_hass_iptables
    - platform: state
      entity_id: sensor.fail2ban_organizr_auth
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: '{{ states.sensor.fail2ban_hass_iptables.state != "None" }}'
      - condition: template
        value_template: '{{ states.sensor.fail2ban_organizr_auth.state != "None" }}'
      - condition: template
        value_template: '{{ states.sensor.fail2ban_nginx_http_auth.state != "None" }}'
  action:
    - service: script.notify_kevin_engine
      data:
        call_failed_login: 1

#--- automation/lights_inside_off.yaml ---
# Turn inside lights off around midnight (before exterior)
  
- id: lights_inside_off
  alias: Lights Inside Off
  trigger:
    - platform: time
      at: '00:12:09'
  action:
    - service: light.turn_off
      entity_id: light.interior_lights

#--- automation/lights_outside_off.yaml ---
# Turn on outside lights off at 12:40 am
  
- id: lights_outdoor_off
  alias: Lights Outdoor Off
  trigger:
    - platform: time
      at: '00:40:07'
  action:
    - service: light.turn_off
      entity_id: light.porch
    - service: switch.turn_off
      entity_id: switch.driveway

#--- automation/notify_on_fire_co.yaml ---
- id: notify_on_fire_co
  alias: Notify on Fire/CO
  trigger:
    - platform: state
      entity_id: sensor.smoke_alarm_foyer
      to: "Fire"
    - platform: state
      entity_id: sensor.smoke_alarm_foyer
      to: "CO"
    - platform: state
      entity_id: sensor.smoke_alarm_family_room
      to: "Fire"
    - platform: state
      entity_id: sensor.smoke_alarm_family_room
      to: "CO"
    - platform: state
      entity_id: sensor.smoke_alarm_office
      to: "Fire"
    - platform: state
      entity_id: sensor.smoke_alarm_office
      to: "CO"
    - platform: state
      entity_id: sensor.smoke_alarm_basement
      to: "Fire"
    - platform: state
      entity_id: sensor.smoke_alarm_basement
      to: "CO"
  action:
    - service: notify.notify
      data_template:
        message: >
            ALERT! {{ now().strftime("%h %d, %Y at %H:%M:S") }} {{trigger.to_state.state}} detected by {{trigger.to_state.attributes.friendly_name}}

#--- automation/notify_on_restart.yaml ---
- id: notify_on_restart
  alias: Notify on Restart
  trigger:
    - platform: homeassistant
      event: start
  action:
    - service: script.notify_kevin_engine
      data:
        call_on_restart: 1

#--- automation/sunset.yaml ---
# Turn on outside lights 15 minutes after sunset
  
- id: lights_sunset
  alias: Lights Sunset
  trigger:
    - platform: sun
      event: sunset
      offset: '+00:15:00'
  action:
    - service: light.turn_on
      entity_id: light.porch
    - service: switch.turn_on
      entity_id: switch.driveway

#--- automation/notify_leak_detected.yaml ---
- id: notify_on_leak_detected
  alias: Notify on Leak Detected
  trigger:
    - platform: state
      entity_id: binary_sensor.leak_sump
      from: 'off'
      to: 'on'
  action:
    - service: notify.notify
      data_template:
        message: >
          ALERT! {{ now().strftime("%h %d, %Y at %H:%M:%S") }} Leak Detected with {{trigger.to_state.attributes.friendly_name}}   

#--- automation/night.yaml ---
- id: night_routine
  alias: Night Routine
  trigger:
    - platform: time
      at: '21:30:30'
  action:
    - service: light.turn_off
      entity_id:
        - light.kitchen_island
        - light.kitchen_table

#--- automation/wakeup.yaml ---
- id: wakeup_routine
  alias: Wakeup Routine
  trigger:
    - platform: time
      at: '06:30:30'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: 'sun.sun'
        state: 'below_horizon'
  action:
    - service: light.turn_on
      entity_id:
        - light.family_room_couch_left
        - light.family_room_couch_right

#--- automation/sunrise.yaml ---
# Turn off inside lights 15 minutes after sunrise
  
- id: lights_sunrise
  alias: Lights Sunrise
  trigger:
    - platform: sun
      event: sunrise
      offset: '+00:15:00'
  action:
    - service: light.turn_off
      entity_id:
        - light.family_room_couch_left
        - light.family_room_couch_right

#--- automation/evening.yaml ---
- id: evening_routine
  alias: Evening Routine
  trigger:
    - platform: sun
      event: sunset
      offset: '-00:40:00'
  action:
    - service: light.turn_on
      entity_id:
        - light.family_room_couch_left
        - light.family_room_couch_right
        - light.kitchen_island
        - light.kitchen_table
        - light.living_room_couch
